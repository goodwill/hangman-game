<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hangman Game</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background: linear-gradient(to bottom, #f0f4f8, #d9e2ec);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #2c3e50;
            font-size: clamp(1.8em, 5vw, 2.5em);
            margin-bottom: 5px;
        }
        #version {
            font-size: clamp(0.8em, 3vw, 1em);
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        .container {
            margin: 20px 0;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            resize: none;
            font-size: 1em;
        }
        select {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 1em;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #3498db;
            color: #fff;
            cursor: pointer;
            font-size: 1em;
            min-width: 120px;
        }
        button:hover {
            background: #2980b9;
        }
        #word-display {
            font-size: clamp(1.5em, 4vw, 2em);
            margin: 20px 0;
            letter-spacing: 5px;
            color: #2c3e50;
            word-break: break-all;
        }
        #guess-input {
            width: 50px;
            padding: 8px;
            font-size: 1em;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            margin: 10px 0;
        }
        #guess-input.whole-word {
            width: 150px;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }
        #hangman-canvas {
            margin: 20px 0;
            width: 200px;
            height: 200px;
        }
        #message {
            font-size: clamp(0.9em, 3vw, 1.1em);
            color: #e74c3c;
            margin-top: 10px;
        }
        .scoreboard {
            flex-direction: column;
            justify-content: space-between;
            gap: 10px;
        }
        .list-container {
            flex: 1;
            min-width: 150px;
            margin: 5px;
        }
        .list-container h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: clamp(1em, 3vw, 1.2em);
        }
        ul {
            list-style-type: none;
            padding: 0;
            max-height: 150px;
            overflow-y: auto;
        }
        li {
            background: #ecf0f1;
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .guess-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .clue {
            display: inline-flex;
            gap: 2px;
        }
        .clue-box {
            width: 12px;
            height: 12px;
            border: 1px solid #bdc3c7;
        }
        .clue-box.black {
            background: #2c3e50;
        }
        .clue-box.white {
            background: #fff;
        }
        .final-score h3 {
            color: #2c3e50;
            font-size: clamp(1.2em, 4vw, 1.5em);
        }
        .final-score-display {
            font-size: clamp(1.2em, 4vw, 1.5em);
            color: #27ae60;
            margin: 20px 0;
        }
        .mode-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        #main-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        @media (min-width: 768px) {
            #main-container {
                flex-direction: row;
                align-items: flex-start;
            }
            .game {
                flex: 2;
                order: 2;
            }
            .scoreboard {
                flex: 1;
                order: 1;
                max-width: 300px;
            }
            .game-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
            }
            #main-container.finish-screen {
                flex-direction: row;
            }
            #main-container.finish-screen .scoreboard {
                flex: 1;
                order: 1;
                max-width: 300px;
            }
            #main-container.finish-screen .final-score {
                flex: 2;
                order: 2;
            }
            #main-container.finish-screen .game {
                display: none;
            }
        }
        @media (max-width: 767px) {
            button {
                width: 100%;
                min-width: unset;
            }
            #guess-input, #guess-input.whole-word {
                width: 100%;
                max-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load React and Babel via CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // App Component
        const App = () => {
            const [gameState, setGameState] = useState('controls');
            const [wordsList, setWordsList] = useState([]);
            const [remainingWords, setRemainingWords] = useState([]);
            const [correctWords, setCorrectWords] = useState([]);
            const [failedWords, setFailedWords] = useState([]);
            const [score, setScore] = useState(0);
            const [totalPoints, setTotalPoints] = useState(0);
            const [lastUsedWords, setLastUsedWords] = useState('');
            const [gameMode, setGameMode] = useState('char');
            const [voices, setVoices] = useState([]);
            const [selectedVoice, setSelectedVoice] = useState(null);

            useEffect(() => {
                loadVoices();
            }, []);

            const loadVoices = () => {
                const availableVoices = window.speechSynthesis.getVoices();
                if (availableVoices.length === 0) {
                    window.speechSynthesis.onvoiceschanged = () => {
                        const voicesList = window.speechSynthesis.getVoices();
                        setVoices(voicesList);
                        if (voicesList.length > 0) setSelectedVoice(voicesList[0]);
                    };
                } else {
                    setVoices(availableVoices);
                    setSelectedVoice(availableVoices[0]);
                }
            };

            const submitWords = (input) => {
                const words = input.split(/[\s,]+/).filter(word => word.length > 0);
                if (words.length === 0) {
                    alert('Please enter valid words!');
                    return;
                }
                setWordsList(words);
                setRemainingWords(words);
                setCorrectWords([]);
                setFailedWords([]);
                setScore(0);
                setTotalPoints(words.length);
                setLastUsedWords(input);
                setGameState('mode');
            };

            const startGame = (mode) => {
                setGameMode(mode);
                setGameState('playing');
            };

            const endGame = () => {
                setGameState('finished');
            };

            const restartGame = () => {
                setGameState('controls');
                setWordsList([]);
                setRemainingWords([]);
                setCorrectWords([]);
                setFailedWords([]);
                setScore(0);
                setTotalPoints(0);
            };

            return (
                <div>
                    <h1>Hangman Game</h1>
                    <p id="version">Version 1.20</p>
                    <div id="main-container" className={gameState === 'finished' ? 'finish-screen' : ''}>
                        {gameState === 'controls' && <Controls onSubmit={submitWords} lastUsedWords={lastUsedWords} />}
                        {gameState === 'mode' && (
                            <ModeSelection
                                onStart={startGame}
                                voices={voices}
                                selectedVoice={selectedVoice}
                                setSelectedVoice={setSelectedVoice}
                            />
                        )}
                        {gameState === 'playing' && (
                            <>
                                <Game
                                    wordsList={remainingWords}
                                    setRemainingWords={setRemainingWords}
                                    correctWords={correctWords}
                                    setCorrectWords={setCorrectWords}
                                    failedWords={failedWords}
                                    setFailedWords={setFailedWords}
                                    score={score}
                                    setScore={setScore}
                                    totalPoints={totalPoints}
                                    gameMode={gameMode}
                                    onEnd={endGame}
                                    selectedVoice={selectedVoice}
                                />
                                <Scoreboard
                                    correctWords={correctWords}
                                    failedWords={failedWords}
                                    score={score}
                                    totalPoints={totalPoints}
                                    remainingWords={remainingWords}
                                />
                            </>
                        )}
                        {gameState === 'finished' && (
                            <>
                                <FinalScore score={score} totalPoints={totalPoints} onRestart={restartGame} />
                                <Scoreboard
                                    correctWords={correctWords}
                                    failedWords={failedWords}
                                    score={score}
                                    totalPoints={totalPoints}
                                    remainingWords={remainingWords}
                                />
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // Controls Component
        const Controls = ({ onSubmit, lastUsedWords }) => {
            const [input, setInput] = useState(lastUsedWords);
            const [wordLists, setWordLists] = useState([]);

            useEffect(() => {
                loadWordLists();
            }, []);

            const loadWordLists = () => {
                const lists = JSON.parse(localStorage.getItem('hangmanWordLists') || '[]');
                setWordLists(lists);
            };

            const saveWordList = (value) => {
                let lists = JSON.parse(localStorage.getItem('hangmanWordLists') || '[]');
                if (!lists.includes(value)) {
                    lists.unshift(value);
                    if (lists.length > 50) lists.pop();
                    localStorage.setItem('hangmanWordLists', JSON.stringify(lists));
                    setWordLists(lists);
                }
            };

            const handleSubmit = () => {
                if (!input.trim()) {
                    alert('Please enter some words first!');
                    return;
                }
                saveWordList(input.trim());
                onSubmit(input.trim());
            };

            return (
                <div className="container">
                    <textarea
                        value={input}
                        onChange={(e) => setInput(e.target.value)}
                        placeholder="Enter words separated by commas or spaces"
                    />
                    <select onChange={(e) => setInput(e.target.value)}>
                        <option value="">Select a previous word list</option>
                        {wordLists.map((list, index) => (
                            <option key={index} value={list}>
                                {list.substring(0, 50) + (list.length > 50 ? '...' : '')}
                            </option>
                        ))}
                    </select>
                    <button onClick={handleSubmit}>Submit Words</button>
                </div>
            );
        };

        // ModeSelection Component
        const ModeSelection = ({ onStart, voices, selectedVoice, setSelectedVoice }) => {
            const preferredVoices = [
                { name: 'Kate', lang: 'en-GB' },
                { name: 'Serena', lang: 'en-GB' },
                { name: 'Daniel', lang: 'en-GB' },
                { name: 'Google UK English Female', lang: 'en-GB' },
                { name: 'Google UK English Male', lang: 'en-GB' },
                { name: 'Microsoft Hazel Desktop', lang: 'en-GB' },
                { name: 'Microsoft George Desktop', lang: 'en-GB' },
                { name: 'Samantha', lang: 'en-US' },
                { name: 'Alex', lang: 'en-US' },
                { name: 'Google US English', lang: 'en-US' },
                { name: 'Google US English Male', lang: 'en-US' },
                { name: 'Microsoft Zira Desktop', lang: 'en-US' },
                { name: 'Microsoft David Desktop', lang: 'en-US' },
            ];

            const availableVoices = voices.filter(voice =>
                preferredVoices.some(p => p.name === voice.name && p.lang === voice.lang)
            ).sort((a, b) => {
                const aIndex = preferredVoices.findIndex(p => p.name === a.name && p.lang === a.lang);
                const bIndex = preferredVoices.findIndex(p => p.name === b.name && p.lang === b.lang);
                return aIndex - bIndex;
            });

            return (
                <div className="container">
                    <h3>Choose Game Mode</h3>
                    <div className="mode-options">
                        <button onClick={() => onStart('char')}>One Character Mode</button>
                        <button onClick={() => onStart('word')}>Whole Word Mode</button>
                        <button onClick={() => onStart('mastermind')}>MasterMind Mode</button>
                    </div>
                    <div className="mode-options">
                        <select
                            value={selectedVoice?.name || ''}
                            onChange={(e) => setSelectedVoice(availableVoices.find(v => v.name === e.target.value))}
                        >
                            <option value="">Select a voice</option>
                            {availableVoices.map((voice) => (
                                <option key={voice.name} value={voice.name}>
                                    {`${voice.name} (${voice.lang})`}
                                </option>
                            ))}
                        </select>
                    </div>
                </div>
            );
        };

        // Game Component
        const Game = ({
            wordsList,
            setRemainingWords,
            correctWords,
            setCorrectWords,
            failedWords,
            setFailedWords,
            score,
            setScore,
            totalPoints,
            gameMode,
            onEnd,
            selectedVoice,
        }) => {
            const [selectedWord, setSelectedWord] = useState('');
            const [hiddenWord, setHiddenWord] = useState('');
            const [guessesLeft, setGuessesLeft] = useState(6);
            const [guessedLetters, setGuessedLetters] = useState(new Set());
            const [guessAttempts, setGuessAttempts] = useState([]);
            const [guessInput, setGuessInput] = useState('');
            const [message, setMessage] = useState('');
            const canvasRef = useRef(null);

            useEffect(() => {
                startNextWord();
            }, []);

            useEffect(() => {
                drawHangman();
            }, [guessesLeft]);

            const drawHangman = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;

                ctx.beginPath();
                ctx.moveTo(50, 180); ctx.lineTo(150, 180);
                ctx.moveTo(100, 180); ctx.lineTo(100, 20);
                ctx.moveTo(100, 20); ctx.lineTo(140, 20);
                ctx.moveTo(140, 20); ctx.lineTo(140, 40);
                ctx.stroke();

                if (guessesLeft < 6) { ctx.beginPath(); ctx.arc(140, 60, 20, 0, Math.PI * 2); ctx.stroke(); }
                if (guessesLeft < 5) { ctx.beginPath(); ctx.moveTo(140, 80); ctx.lineTo(140, 120); ctx.stroke(); }
                if (guessesLeft < 4) { ctx.beginPath(); ctx.moveTo(140, 90); ctx.lineTo(120, 110); ctx.stroke(); }
                if (guessesLeft < 3) { ctx.beginPath(); ctx.moveTo(140, 90); ctx.lineTo(160, 110); ctx.stroke(); }
                if (guessesLeft < 2) { ctx.beginPath(); ctx.moveTo(140, 120); ctx.lineTo(120, 150); ctx.stroke(); }
                if (guessesLeft < 1) { ctx.beginPath(); ctx.moveTo(140, 120); ctx.lineTo(160, 150); ctx.stroke(); }
            };

            const startNextWord = () => {
                if (wordsList.length === 0) {
                    onEnd();
                    return;
                }
                const word = wordsList[Math.floor(Math.random() * wordsList.length)].toLowerCase();
                setSelectedWord(word);
                setRemainingWords(wordsList.filter(w => w.toLowerCase() !== word));
                setHiddenWord('-'.repeat(word.length));
                setGuessesLeft(6);
                setGuessedLetters(new Set());
                setGuessAttempts([]);
                setMessage(`Guesses left: 6`);
                setGuessInput('');
                speakWordWithVoice(word);
            };

            const getMasterMindClue = (guess) => {
                let clue = [];
                const target = selectedWord.split('');
                const guessed = guess.split('');
                const used = new Set();

                for (let i = 0; i < Math.min(target.length, guessed.length); i++) {
                    if (guessed[i] === target[i]) {
                        clue.push('black');
                        used.add(i);
                        target[i] = null;
                    }
                }

                for (let i = 0; i < guessed.length; i++) {
                    if (!clue[i] && target.includes(guessed[i])) {
                        const pos = target.indexOf(guessed[i]);
                        if (!used.has(pos)) {
                            clue[i] = 'white';
                            used.add(pos);
                            target[pos] = null;
                        }
                    }
                }

                for (let i = clue.length; i < selectedWord.length; i++) {
                    clue[i] = '';
                }
                return clue;
            };

            const makeGuess = () => {
                const guess = guessInput.toLowerCase().trim();
                if (!guess) {
                    speakWord();
                    return;
                }

                if (gameMode === 'char') {
                    if (guess.length !== 1 || !/[a-z]/.test(guess)) {
                        alert('Please enter a single letter!');
                        return;
                    }
                    if (guessedLetters.has(guess)) {
                        alert('You already guessed that letter!');
                        return;
                    }
                    const newGuessedLetters = new Set(guessedLetters);
                    newGuessedLetters.add(guess);
                    setGuessedLetters(newGuessedLetters);
                    setGuessAttempts([{ guess, clue: null }, ...guessAttempts]);
                    setGuessInput('');

                    if (selectedWord.includes(guess)) {
                        const newHiddenWord = selectedWord.split('').map((char, i) =>
                            char === guess ? guess : hiddenWord[i]
                        ).join('');
                        setHiddenWord(newHiddenWord);

                        if (!newHiddenWord.includes('-')) {
                            setCorrectWords([...correctWords, selectedWord]);
                            setScore(score + 1);
                            setMessage('You win! Next word...');
                            setTimeout(startNextWord, 1000);
                        }
                    } else {
                        setGuessesLeft(guessesLeft - 1);
                        setMessage(`Guesses left: ${guessesLeft - 1}`);
                        if (guessesLeft - 1 === 0) {
                            setFailedWords([...failedWords, selectedWord]);
                            setMessage(`Game Over! The word was: ${selectedWord}. Next word...`);
                            setTimeout(startNextWord, 1000);
                        }
                    }
                } else {
                    if (guessedLetters.has(guess)) {
                        alert('You already guessed that word!');
                        return;
                    }
                    const newGuessedLetters = new Set(guessedLetters);
                    newGuessedLetters.add(guess);
                    setGuessedLetters(newGuessedLetters);
                    const clue = gameMode === 'mastermind' ? getMasterMindClue(guess) : null;
                    setGuessAttempts([{ guess, clue }, ...guessAttempts]);
                    setGuessInput('');

                    if (guess === selectedWord) {
                        setHiddenWord(selectedWord);
                        setCorrectWords([...correctWords, selectedWord]);
                        setScore(score + 1);
                        setMessage('You win! Next word...');
                        setTimeout(startNextWord, 1000);
                    } else {
                        setGuessesLeft(guessesLeft - 1);
                        setMessage(`Guesses left: ${guessesLeft - 1}`);
                        if (guessesLeft - 1 === 0) {
                            setFailedWords([...failedWords, selectedWord]);
                            setMessage(`Game Over! The word was: ${selectedWord}. Next word...`);
                            setTimeout(startNextWord, 1000);
                        }
                    }
                }
            };

            const speakWord = () => {
                if (!selectedWord) {
                    alert('Start a game first!');
                    return;
                }
                speakWordWithVoice(selectedWord);
            };

            const speakWordWithVoice = (word) => {
                const speech = new SpeechSynthesisUtterance(word);
                if (selectedVoice) {
                    speech.voice = selectedVoice;
                    speech.lang = selectedVoice.lang;
                }
                const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
                speech.rate = isSafari ? 0.9 : 1.0;
                speech.pitch = isSafari && selectedVoice?.lang === 'en-GB' ? 1.1 : 1.0;
                window.speechSynthesis.speak(speech);
            };

            return (
                <div className="container game">
                    <div id="word-display">{hiddenWord}</div>
                    <div>Total characters: {selectedWord.length}</div>
                    <div className="game-container">
                        <canvas ref={canvasRef} id="hangman-canvas" width="200" height="200"></canvas>
                        <div className="list-container">
                            <h3>Guess Attempts</h3>
                            <ul className="guess-list">
                                {guessAttempts.map(({ guess, clue }, index) => (
                                    <li key={index}>
                                        {guess}
                                        {clue && (
                                            <span className="clue">
                                                {clue.map((c, i) => (
                                                    <span key={i} className={`clue-box ${c}`}></span>
                                                ))}
                                            </span>
                                        )}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                    <input
                        id="guess-input"
                        type="text"
                        value={guessInput}
                        onChange={(e) => setGuessInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && makeGuess()}
                        className={gameMode !== 'char' ? 'whole-word' : ''}
                        placeholder={gameMode === 'char' ? 'Guess a letter' : gameMode === 'mastermind' ? 'Guess the word' : 'Guess whole word'}
                        maxLength={gameMode === 'char' ? 1 : undefined}
                    />
                    <button onClick={makeGuess}>Guess</button>
                    <button onClick={speakWord}>Read Word</button>
                    <div id="message">{message}</div>
                </div>
            );
        };

        // Scoreboard Component
        const Scoreboard = ({ correctWords, failedWords, score, totalPoints, remainingWords }) => {
            return (
                <div className="container scoreboard">
                    <div className="list-container">
                        <h3>Correctly Guessed</h3>
                        <ul>
                            {correctWords.map((word, index) => <li key={index}>{word}</li>)}
                        </ul>
                    </div>
                    <div className="list-container">
                        <h3>Failed to Guess</h3>
                        <ul>
                            {failedWords.map((word, index) => <li key={index}>{word}</li>)}
                        </ul>
                    </div>
                    <div className="list-container">
                        <h3>Score</h3>
                        <p>{`${score} / ${totalPoints}`}</p>
                        <p>Remaining Words: {remainingWords.length}</p>
                    </div>
                </div>
            );
        };

        // FinalScore Component
        const FinalScore = ({ score, totalPoints, onRestart }) => {
            return (
                <div className="container final-score">
                    <h3>Game Over - Final Score</h3>
                    <p className="final-score-display">{`${score} / ${totalPoints}`}</p>
                    <button onClick={onRestart}>Start Over</button>
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>